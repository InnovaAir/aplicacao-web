<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../styles/menuLateral.css" />
  <link rel="stylesheet" href="../styles/dashRoberto.css" />
  <link rel="stylesheet" href="../styles/menu_mobile.css" />
  <link rel="stylesheet" href="../styles/estilo.css" />


  <title>Visão geral</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>

<body>
  <button class="botao_abrir" onclick="abrirMenu()">☰</button>

  <div class="sidebar" id="sidebar">
    <div class="d-flex justify-content-center align-items-center px-3 w-100">
        <div class="logo">
            <img src="../assets/InnovaairWhite.png" alt="Logo">
        </div>
    </div>
    <nav class="flex-column">
        <a href="dashRoberto.html">Visão geral</a>
        <a href="cadastrarFuncionario.html"><strong>Cadastrar Funcionario</strong></a>
        <a style="display: none;" href="visaoGeral.html"><strong>Análise em tempo real</strong></a>
        <a style="display: none;" href="suporte.html">Suporte</a>
        <div class="logout mt-3">
            <a onclick="limparSessao()" href="../index.html"><strong>Sair</strong></a>
        </div>
    </nav>
</div>

  <div class="menu_mobile">
    <button class="botao_menu_mobile" onclick="abrirMenuMobile()">☰</button>
    <div class="logo_container">
      <img src="../assets/InnovaairWhite.png" alt="" />
    </div>
  </div>
  <div class="novo_menu">
    <a href="visaoGeral.html" class="agora">Visão geral</a>
    <a href="tempoReal.html">Tempo real</a>
    <a href="listaMaquinas.html">Lista de máquinas</a>
    <a href="NovosCadastros.html">Cadastros</a>
    <a href="suporte.html">Suporte</a>
    <a href="suporte.html">Fale conosco!</a>
  </div>

  <div id="tela" class="tamanho_dash">
    <div class="container_componente">
      <div class="titulo">
        <span id="titulo_01">
          <b>Análise Geral por Endereço</b>
        </span>
        <span id="titulo_02">
          <i><b>*Selecione os filtros para a visualização</b></i>
        </span>
      </div>

      <div class="select-wrapper">
        <div class="custom-select">
          <select id="select_aeroporto">
            <option value="" disabled>Selecione o Aeroporto</option>
            <option value="gru" selected>GRU</option>
            <option value="cgh">Congonhas</option>
          </select>
        </div>

        <div class="custom-select">
          <select id="select_intervalo">
            <option value="" disabled>Selecione o intervalo</option>
            <option value="7" selected>Últimos 7 dias</option>
            <option value="15">Últimos 15 dias</option>
            <option value="30">Últimos 30 dias</option>
          </select>
        </div>
      </div>

      <div class="box_grafico">
        <div class="grafico_alinhado">
          <div class="titulo_grafico1">
            <span id="titulo_01">
              Quantidade de alertas por categoria do componente
            </span>
            <span id="titulo_02">
              <i>*Um componente pode emitir mais de um alerta, organizado pelos níveis de alerta.</i>
            </span>
          </div>
          <div class="grafico_01">
            <div id="chart_barras"></div>
          </div>
        </div>

        <div class="box" id="grafico_periodo">
          <div class="kpi_alinhada">
            <div class="titulo_grafico2">
              <span id="titulo_01">
                Periodicidade de alertas
              </span>
              <span id="titulo_02">
                <i>*Horario do dia com mais alertas, no intervalo selecionado</i>
              </span>
            </div>

            <div class="box_kpi">
              <span id="titulo_kpi">Intervalo com maior pico</span>
              <b><span id="valor_kpi">Tarde</span> (13:00 → 18:00)</b>
            </div>
          </div>

          <div class="grafico1">
            <div id="chart_barras2"></div>
          </div>
        </div>
      </div>

      <div>
        <div class="container_tabela">
          <div class="titulo_grafico3">
            <div class="titulo_alinhado">
              <span id="titulo_01">
                Lista de Componentes
              </span>
              <span id="titulo_02">
                <i>*Por nível de gravidade do alerta</i>
              </span>
            </div>
            
            <div class="select-wrapper">
              <div class="custom-select">
                <select id="select_aeroporto">
                  <option value="" disabled>Selecione o nível do alerta</option>
                  <option value="baixo">Baixo</option>
                  <option value="alto" selected>Alto</option>
                  <option value="critico">Crítico</option>
                </select>
              </div>
              
              <div class="custom-select">
                <select id="select_intervalo">
                  <option value="" selected disabled>Selecione o componente</option>
                  <option value="processador" selected>Processador</option>
                  <option value="ram">RAM</option>
                  <option value="disco">Disco</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="box_tabela">
          <div class="tabela-scroll">
            <table class="tabela-alertas">
              <thead>
                <tr>
                  <th>Componente</th>
                  <th>Nível</th>
                  <th>Total Alertas</th>
                  <th>Qtd. máquinas c/ componente</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    Processador <br><small>I3 7200u</small>
                  </td>
                  <td><span style="color: red;">▲</span> ALTO</td>
                  <td>7</td>
                  <td>21</td>
                </tr>
                <td>
                  Processador <br><small>Pentium g5400</small>
                </td>
                <td><span style="color: red;">▲</span> ALTO</td>
                <td>5</td>
                <td>12</td>
                </tr>
                <tr>
                  <td>
                    Processador <br><small>Ryzen 3 3200g</small>
                  </td>
                  <td><span style="color: red;">▲</span> ALTO</td>
                  <td>2</td>
                  <td>43</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="kpi_empilhada">
            <div class="kpi_tabela">
              <span id="titulo_kpi">Quantidade de máquinas registradas</span>
              <span id="valor_kpi"><b>900</b></span>
            </div>
            <div class="kpi_tabela">
              <span id="titulo_kpi">Nível de alerta com mais registros</span>
              <span id="valor_kpi"><b><span style="color: red;">▲</span> ALTO</b></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>

<script src="../js/animacaoMenu.js"></script>

<script>
obterFiliaisGerente()
function obterFiliaisGerente(){

  fetch(`/cadastros/metricas/listar/filiais/${sessionStorage.idUsuario}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then((answer) => {
                answer.json().then(json_select => {
                    json_filiais = json_select;

                    var select_aeroporto = document.getElementById("select_aeroporto");

                    select_aeroporto.innerHTML = `<option selected disabled value="null">Selecione um aeroporto</option>`


                    for (let i = 0; i < json_filiais.length; i++) {
                        var filialAtual = json_filiais[i];

                        // Insere cada opção 
                        select_aeroporto.innerHTML += `<option value="${filialAtual.idFilial}">${filialAtual.terminal}</option>`
                    }
                })
            })
            .catch(() => {
                print("Erro ao realizar o Fetch")
            });
    };

  var chart = new ApexCharts(document.querySelector("#chart_barras"), options);
  chart.render();


  var options = {
    series: [{
      name: 'Qtd.',
      data: [28, 7, 32, 19]
    }],
    chart: {
      height: 350,
      type: 'bar',
    },
    plotOptions: {
      bar: {
        borderRadius: 10,
        dataLabels: {
          position: 'top',
        },
      }
    },
    dataLabels: {
      enabled: true,
      formatter: function (val) {
        return val;
      },
      offsetY: -20,
      style: {
        fontSize: '12px',
        colors: ["#304758"]
      }
    },

    xaxis: {
      categories: ["00h00 → 06h00", "07h00 → 12h00", "13h00 → 18h00", "19h00 → 23h00"],
      position: 'top',
      axisBorder: {
        show: false
      },
      axisTicks: {
        show: false
      },
      crosshairs: {
        fill: {
          type: 'gradient',
          gradient: {
            colorFrom: '#D8E3F0',
            colorTo: '#BED1E6',
            stops: [0, 100],
            opacityFrom: 0.4,
            opacityTo: 0.5,
          }
        }
      },
      tooltip: {
        enabled: true,
      }
    },
    yaxis: {
      axisBorder: {
        show: false
      },
      axisTicks: {
        show: false,
      },
      labels: {
        show: false,
        formatter: function (val) {
          return val;
        }
      }

    },
    title: {
      text: 'Quantidade de alertas pelo período do dia',
      floating: true,
      offsetY: 330,
      align: 'center',
      style: {
        color: '#444'
      }
    }
  };

  var chart = new ApexCharts(document.querySelector("#chart_barras2"), options);
  chart.render();


  abrirMenu();
</script>